{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
  <section>
    <div class="container">
      <div class="row align-items-center">
        <div class="p-5">
          <h2 class="display-4">Register your account</h2>
              <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Quod aliquid, mollitia odio veniam sit iste esse assumenda amet aperiam exercitationem, ea animi blanditiis recusandae! Ratione voluptatum molestiae adipisci, beatae obcaecati.</p>
        </div>
        <div class="p-5">
          {% if form.errors %}
            <p>Something went wrong. Please try again.</p>
          {% endif %}

          {% if next %}
            {% if user.is_authenticated %}
              <p>Your account doesn't have access to this page. To proceed,
              please login with an account that has access.</p>
            {% else %}
              <p>Please login to see this page.</p>
            {% endif %}
          {% endif %}

          <form method="post" id="registrationForm" action="{% url 'register' %}" data-divisions-url="{% url 'ajax_load_divisions' %}" novalidate>
            {% csrf_token %}
            {% crispy form %}
          </form>
          
          <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
          <script>
            $("#id_bureau").change(function () {
              var url = $("#registrationForm").attr("data-divisions-url");  // get the url of the `load_divisions` view
              var bureauId = $(this).val();  // get the selected bureau ID from the HTML input

              $.ajax({                       // initialize an AJAX request
                url: url,                    // set the url of the request (= localhost:8000/ajax/load-divisions/)
                data: {
                  'bureau': bureauId       // add the bureau id to the GET parameters
                },
                success: function (data) {   // `data` is the return of the `load_divisions` view function
                  $("#id_division").html(data);  // replace the contents of the division input with the data that came from the server
                }
              });

            });
          </script>
        </div>
      </div>
    <div>
  </section>
{% endblock %}

